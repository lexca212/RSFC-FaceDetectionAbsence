{% extends 'layouts/payroll_layout.html' %}
{% load static %}
{% block content %}

<div class="container-fluid pb-3">

  <div class="card card-outline card-primary shadow-sm p-3">

    <!-- HEADER -->
    <div class="card-header">
      <div
        class="d-flex justify-content-between align-items-center flex-wrap">
        <div>
          <h4 class="mb-0 font-weight-bold">
            Data Karyawan
          </h4>
          <small class="text-muted">
            Total {{ page_obj.paginator.count }} karyawan terdaftar
          </small>
        </div>
      </div>

      <!-- SEARCH BAR -->
      <form method="GET" class="mt-3">
        <div class="input-group" style="max-width:420px;">
          <input type="text" name="q" value="{{ query }}"
            class="form-control"
            placeholder="Cari nama, NIK, email, divisi...">
          <div class="input-group-append">
            <button class="btn btn-primary"><i
                class="fa fa-search"></i></button>
            {% if query %}
            <a href="{{ request.path }}" class="btn btn-outline-danger">
              <i class="fa fa-times"></i>
            </a>
            {% endif %}
          </div>
        </div>
      </form>
    </div>

    <!-- TABLE -->
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="bg-light">
            <tr class="text-center">
              <th width="60">No</th>
              <th>NIK</th>
              <th>Nama</th>
              <th>Email</th>
              <th>Divisi</th>
              <th width="150">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for user in page_obj %}
            <tr>
              <td class="text-center">{{ forloop.counter }}</td>
              <td>{{ user.nik }}</td>
              <td class="font-weight-bold">{{ user.name }}</td>
              <td>{{ user.email }}</td>
              <td class="text-center">
                <span class="px-3 py-1">
                  {{ user.divisi.name }}
                </span>
              </td>
              <td class="text-center">
                <a href="{% url 'detail_gaji' user.nik %}"
                  class="btn btn-info btn-xs" title="Detail"><i
                    class="fas fa-eye"></i> Detail </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center text-muted py-4">
                Tidak ada data ditemukan
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- FOOTER PAGINATION -->
    <div class="card-footer">
      <div
        class="d-flex justify-content-between align-items-center flex-wrap">
        <small class="text-muted">
          Halaman {{ page_obj.number }} dari {{ page_obj.paginator.num_pages}}
        </small>

        <ul class="pagination pagination-sm m-0">
          {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link"
              href="?page=1">«</a></li>
          <li class="page-item"><a class="page-link"
              href="?page={{ page_obj.previous_page_number }}">Prev</a></li>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
          {% if num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
          <li class="page-item {% if page_obj.number == num %}active{% endif %}">
            <a class="page-link"href="?page={{ num }}{% if query %}&q={{ query }}{% endif %}">{{num }}</a>
          </li>
          {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link"
              href="?page={{ page_obj.next_page_number }}">Next</a></li>
          <li class="page-item"><a class="page-link"
              href="?page={{ page_obj.paginator.num_pages }}">»</a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).on('click','.btn-hapus',function(e){
    e.preventDefault();
    let url=$(this).data('url');
    Swal.fire({
        title:'Hapus karyawan?',
        text:'Data tidak bisa dikembalikan',
        icon:'warning',
        showCancelButton:true,
        confirmButtonText:'Hapus',
        cancelButtonText:'Batal'
    }).then((r)=>{
        if(r.isConfirmed){window.location=url}
    })
})
</script>

{% endblock %}
